{% extends 'base.html' %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <style>
        .ui-autocomplete {
            max-height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
            z-index: 1000;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .ui-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        .ui-menu-item:last-child {
            border-bottom: none;
        }
        .ui-state-active {
            background: #007bff !important;
            border-color: #007bff !important;
            color: white !important;
        }
    </style>
{% endblock %}

{% block content %}
    <form method="POST" action="{{ url_for('handle_search') }}" id="searchForm">
        <div class="mb-3">
            <input type="text" class="form-control" name="query" id="query" 
                   placeholder="Enter your search query" value="{{ query }}" autofocus>
        </div>
    </form>

    <script>
    $(document).ready(function() {
        $("#query").autocomplete({
            source: "{{ url_for('autocomplete') }}",
            minLength: 2,
            select: function(event, ui) {
                if (ui.item) {
                    $("#query").val(ui.item.value);
                    $("#searchForm").submit();
                }
            }
        }).autocomplete("instance")._renderItem = function(ul, item) {
            return $("<li>")
                .append("<div>" + item.label + "</div>")
                .appendTo(ul);
        };
    });
    </script>

    {% if results %}
        <!-- Rest of your existing template remains the same -->
        <!-- ... -->
    {% elif request.method == 'POST' %}
        <p>No results found.</p>
    {% endif %}
{% endblock %}